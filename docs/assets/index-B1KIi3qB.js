import{c as oe,a as _,o as k,b as r,d as W,r as Ue,t as Q,F as ke,e as Re,n as Pe,f as Ce,g as le,w as We,h as M,i as Ae,j as Se,T as ut,k as Ie,l as Oe,m as Ve,p as ye,q as Xe,s as Ye,u as re,v as ge,x as je,y as He,z as ct,A as ht}from"./vendor-BKv1Mm4a.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))e(m);new MutationObserver(m=>{for(const w of m)if(w.type==="childList")for(const y of w.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&e(y)}).observe(document,{childList:!0,subtree:!0});function o(m){const w={};return m.integrity&&(w.integrity=m.integrity),m.referrerPolicy&&(w.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?w.credentials="include":m.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function e(m){if(m.ep)return;m.ep=!0;const w=o(m);fetch(m.href,w)}})();typeof globalThis>"u"&&(window.global=window);typeof process>"u"&&(window.process={env:{}});(typeof crypto>"u"||!crypto.getRandomValues)&&typeof window<"u"&&(window.crypto||(window.crypto={}),window.crypto.getRandomValues||(window.crypto.getRandomValues=function(n){for(let t=0;t<n.length;t++)n[t]=Math.floor(Math.random()*256);return n}));typeof Buffer>"u"&&typeof window<"u"&&(window.Buffer={isBuffer:()=>!1});const we=(n,t)=>{const o=n.__vccOpts||n;for(const[e,m]of t)o[e]=m;return o},mt={name:"DraggableElement",props:{element:{type:Object,required:!0},isDragging:{type:Boolean,default:!1},isResizing:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},isInGroup:{type:Boolean,default:!1},enableResize:{type:Boolean,default:!0},resizeHandles:{type:Array,default:()=>["n","ne","e","se","s","sw","w","nw"]}},emits:["mousedown","click","resize-start","contextmenu"],setup(n,{emit:t}){const o=oe(()=>({left:`${n.element.x}px`,top:`${n.element.y}px`,width:`${n.element.width}px`,height:`${n.element.height}px`})),e=oe(()=>Array.isArray(n.resizeHandles)?n.resizeHandles:["n","ne","e","se","s","sw","w","nw"]),m=oe(()=>n.isResizing);return{elementStyle:o,resizeHandlesArray:e,showSizeHint:m,handleMouseDown:b=>{t("mousedown",b,n.element)},handleClick:b=>{b.stopPropagation(),t("click",b,n.element)},handleMouseUp:b=>{},handleResizeStart:(b,z)=>{t("resize-start",b,n.element,z)},handleContextMenu:b=>{b.preventDefault(),t("contextmenu",b,n.element)}}}},ft={class:"element-content"},gt={key:0,class:"selection-indicator"},yt={key:1,class:"group-indicator"},vt={key:2,class:"size-hint"},pt={class:"size-text"},xt={key:3,class:"element-handles"},bt=["onMousedown"];function wt(n,t,o,e,m,w){return k(),_("div",{class:Ce(["draggable-element",{dragging:o.isDragging},{resizing:o.isResizing},{selected:o.isSelected},{"in-group":o.isInGroup}]),style:Pe(e.elementStyle),onMousedown:t[0]||(t[0]=(...y)=>e.handleMouseDown&&e.handleMouseDown(...y)),onClick:t[1]||(t[1]=(...y)=>e.handleClick&&e.handleClick(...y)),onMouseup:t[2]||(t[2]=(...y)=>e.handleMouseUp&&e.handleMouseUp(...y)),onContextmenu:t[3]||(t[3]=(...y)=>e.handleContextMenu&&e.handleContextMenu(...y))},[r("div",ft,[Ue(n.$slots,"default",{element:o.element},()=>[le(Q(o.element.content),1)])]),o.isSelected?(k(),_("div",gt,t[4]||(t[4]=[r("div",{class:"selection-dot"},null,-1)]))):W("",!0),o.isInGroup?(k(),_("div",yt,t[5]||(t[5]=[r("span",{class:"group-icon"},"🔗",-1)]))):W("",!0),o.isResizing&&e.showSizeHint?(k(),_("div",vt,[r("span",pt,Q(o.element.width)+" × "+Q(o.element.height),1)])):W("",!0),o.enableResize&&!o.isInGroup?(k(),_("div",xt,[(k(!0),_(ke,null,Re(e.resizeHandlesArray,y=>(k(),_("div",{key:y,class:Ce(["resize-handle",y]),onMousedown:We(d=>e.handleResizeStart(d,y),["stop"])},null,42,bt))),128))])):W("",!0)],38)}const qe=we(mt,[["render",wt],["__scopeId","data-v-2170fb74"]]),Mt={name:"PerformancePanel",props:{visible:{type:Boolean,default:!0},title:{type:String,default:"性能监控"},showCloseButton:{type:Boolean,default:!1},position:{type:String,default:"top-right",validator:n=>["top-right","top-left","bottom-right","bottom-left"].includes(n)},showFps:{type:Boolean,default:!0},showRenderTime:{type:Boolean,default:!0},showDragTime:{type:Boolean,default:!0},showMemoryUsage:{type:Boolean,default:!0},showElementCount:{type:Boolean,default:!0},showTotalElements:{type:Boolean,default:!1},metrics:{type:Object,default:()=>({fps:0,renderTime:0,dragTime:0,memoryUsage:0})},elementCount:{type:Number,default:0},totalElements:{type:Number,default:0},theme:{type:String,default:"dark"},compact:{type:Boolean,default:!1}},emits:["close","drag-start","drag-move","drag-end"],setup(n,{emit:t}){const o=M(!1),e=M({x:0,y:0}),m=M(null),w=b=>b>=55?"fps-excellent":b>=45?"fps-good":b>=30?"fps-warning":"fps-poor",y=b=>{if(!n.draggable)return;o.value=!0;const z=m.value.getBoundingClientRect();e.value={x:b.clientX-z.left,y:b.clientY-z.top},document.addEventListener("mousemove",d),document.addEventListener("mouseup",T),t("drag-start",b)},d=b=>{if(!o.value)return;const z=b.clientX-e.value.x,N=b.clientY-e.value.y;m.value&&(m.value.style.left=`${z}px`,m.value.style.top=`${N}px`),t("drag-move",b)},T=b=>{o.value=!1,document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",T),t("drag-end",b)},U=()=>{t("close")};return Ae(()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",T)}),{isDragging:o,panelRef:m,getFpsClass:w,startDrag:y,close:U}}},zt={class:"panel-title"},Et={class:"performance-metrics"},St={key:0,class:"metric-item"},Ct={key:1,class:"metric-item"},Dt={class:"metric-value"},kt={key:2,class:"metric-item"},Rt={class:"metric-value"},Bt={key:3,class:"metric-item"},Gt={class:"metric-value"},Pt={key:4,class:"metric-item"},Lt={class:"metric-value"},Tt={key:5,class:"metric-item"},_t={class:"metric-value"};function Ut(n,t,o,e,m,w){return o.visible?(k(),_("div",{key:0,class:Ce(["performance-panel",o.position])},[r("div",{class:"performance-header",onMousedown:t[1]||(t[1]=(...y)=>e.startDrag&&e.startDrag(...y))},[r("span",zt,Q(o.title),1),o.showCloseButton?(k(),_("button",{key:0,onClick:t[0]||(t[0]=(...y)=>e.close&&e.close(...y)),class:"close-btn"}," × ")):W("",!0)],32),r("div",Et,[o.showFps?(k(),_("div",St,[t[2]||(t[2]=r("span",{class:"metric-label"},"FPS:",-1)),r("span",{class:Ce(["metric-value",e.getFpsClass(o.metrics.fps)])},Q(o.metrics.fps),3)])):W("",!0),o.showRenderTime?(k(),_("div",Ct,[t[3]||(t[3]=r("span",{class:"metric-label"},"渲染时间:",-1)),r("span",Dt,Q(o.metrics.renderTime.toFixed(1))+"ms ",1)])):W("",!0),o.showDragTime?(k(),_("div",kt,[t[4]||(t[4]=r("span",{class:"metric-label"},"拖拽时间:",-1)),r("span",Rt,Q(o.metrics.dragTime.toFixed(1))+"ms ",1)])):W("",!0),o.showMemoryUsage&&o.metrics.memoryUsage>0?(k(),_("div",Bt,[t[5]||(t[5]=r("span",{class:"metric-label"},"内存:",-1)),r("span",Gt,Q(o.metrics.memoryUsage)+"MB ",1)])):W("",!0),o.showElementCount?(k(),_("div",Pt,[t[6]||(t[6]=r("span",{class:"metric-label"},"可见元素:",-1)),r("span",Lt,Q(o.elementCount),1)])):W("",!0),o.showTotalElements?(k(),_("div",Tt,[t[7]||(t[7]=r("span",{class:"metric-label"},"总元素:",-1)),r("span",_t,Q(o.totalElements),1)])):W("",!0),Ue(n.$slots,"custom-metrics",{},void 0)])],2)):W("",!0)}const It=we(Mt,[["render",Ut],["__scopeId","data-v-6f75f1c9"]]),Xt={name:"GroupBorder",props:{visible:{type:Boolean,default:!1},bounds:{type:Object,default:()=>({x:0,y:0,width:0,height:0})},elementCount:{type:Number,default:0},groupId:{type:[Number,String],required:!0}},emits:["mousedown","resize-start"],setup(n,{emit:t}){const o=["n","ne","e","se","s","sw","w","nw"],e=oe(()=>({left:`${n.bounds.x}px`,top:`${n.bounds.y}px`,width:`${n.bounds.width}px`,height:`${n.bounds.height}px`}));return{resizeHandles:o,borderStyle:e,handleMouseDown:y=>{t("mousedown",y)},handleResizeStart:(y,d)=>{t("resize-start",y,d)}}}},Yt=["data-group-id"],Ft=["onMousedown"],Ht={class:"group-info"},Vt={class:"group-count"};function Wt(n,t,o,e,m,w){return o.visible?(k(),_("div",{key:0,class:"group-border",style:Pe(e.borderStyle),"data-group-id":o.groupId,onMousedown:t[0]||(t[0]=(...y)=>e.handleMouseDown&&e.handleMouseDown(...y))},[(k(!0),_(ke,null,Re(e.resizeHandles,y=>(k(),_("div",{key:y,class:Ce(["resize-handle",y]),onMousedown:We(d=>e.handleResizeStart(d,y),["stop"])},null,42,Ft))),128)),r("div",Ht,[r("span",Vt,Q(o.elementCount)+" 个组件",1)])],44,Yt)):W("",!0)}const Ke=we(Xt,[["render",Wt],["__scopeId","data-v-665bd64c"]]),At={name:"SelectionBox",props:{visible:{type:Boolean,default:!1},startX:{type:Number,default:0},startY:{type:Number,default:0},endX:{type:Number,default:0},endY:{type:Number,default:0}},setup(n){return{boxStyle:oe(()=>{const o=Math.min(n.startX,n.endX),e=Math.min(n.startY,n.endY),m=Math.abs(n.endX-n.startX),w=Math.abs(n.endY-n.startY);return{left:`${o}px`,top:`${e}px`,width:`${m}px`,height:`${w}px`}})}}};function Ot(n,t,o,e,m,w){return o.visible?(k(),_("div",{key:0,class:"selection-box",style:Pe(e.boxStyle)},null,4)):W("",!0)}const Je=we(At,[["render",Ot],["__scopeId","data-v-7f19b5bb"]]),Nt={name:"ContextMenu",props:{visible:{type:Boolean,default:!1},x:{type:Number,default:0},y:{type:Number,default:0},targetElements:{type:Array,default:()=>[]},canGroup:{type:Boolean,default:!1},canUngroup:{type:Boolean,default:!1}},emits:["group","ungroup","delete","close"],setup(n,{emit:t}){const o=oe(()=>({left:`${n.x}px`,top:`${n.y}px`})),e=()=>{t("close")};return{menuStyle:o,hideMenu:e,handleGroup:()=>{t("group"),e()},handleUngroup:()=>{t("ungroup"),e()},handleDelete:()=>{t("delete"),e()}}}},jt={class:"menu-header"},qt={class:"menu-content"},Kt={key:2,class:"menu-divider"};function Jt(n,t,o,e,m,w){return k(),Se(ut,{to:"body"},[o.visible?(k(),_("div",{key:0,class:"context-menu",style:Pe(e.menuStyle),onClick:t[4]||(t[4]=We(()=>{},["stop"]))},[r("div",jt,[t[5]||(t[5]=r("span",{class:"menu-title"},"操作菜单",-1)),r("button",{class:"close-btn",onClick:t[0]||(t[0]=(...y)=>e.hideMenu&&e.hideMenu(...y))},"×")]),r("div",qt,[o.canGroup?(k(),_("div",{key:0,class:"menu-item",onClick:t[1]||(t[1]=(...y)=>e.handleGroup&&e.handleGroup(...y))},t[6]||(t[6]=[r("span",{class:"menu-icon"},"🔗",-1),r("span",{class:"menu-text"},"成组",-1)]))):W("",!0),o.canUngroup?(k(),_("div",{key:1,class:"menu-item",onClick:t[2]||(t[2]=(...y)=>e.handleUngroup&&e.handleUngroup(...y))},t[7]||(t[7]=[r("span",{class:"menu-icon"},"🔓",-1),r("span",{class:"menu-text"},"解组",-1)]))):W("",!0),o.canGroup||o.canUngroup?(k(),_("div",Kt)):W("",!0),r("div",{class:"menu-item danger",onClick:t[3]||(t[3]=(...y)=>e.handleDelete&&e.handleDelete(...y))},t[8]||(t[8]=[r("span",{class:"menu-icon"},"🗑️",-1),r("span",{class:"menu-text"},"删除",-1)]))])],4)):W("",!0)])}const Qe=we(Nt,[["render",Jt],["__scopeId","data-v-8a0939e9"]]);function Ze(n={}){const{onDragStart:t,onDragMove:o,onDragEnd:e,onResizeStart:m,onResizeMove:w,onResizeEnd:y,snapDistance:d=10,enableSnap:T=!0,enableResize:U=!0,elements:b=M([]),workspaceRef:z=M(null),measureDrag:N=null,multiSelect:j=null}=n,q=M(null),I=M(null),A=M([]),te=Ie({x:0,y:0}),G=(v,s,a)=>{if(v.target.classList.contains("resize-handle"))return;if(j&&j.isElementSelected(s.id)&&j.getSelectedCount()>1){j.startMultiDrag(v,s,a);return}q.value=s.id;const i=a.getBoundingClientRect();s.startX=v.clientX-i.left-s.x,s.startY=v.clientY-i.top-s.y,P(s.id,b);const h=f=>O(f,a),p=()=>K();document.addEventListener("mousemove",h),document.addEventListener("mouseup",p),s._dragMoveHandler=h,s._dragEndHandler=p,t==null||t(s,v)},P=(v,s)=>{const a=s.value.find(h=>h.id===v);if(!a)return;const i=s.value.findIndex(h=>h.id===v);i>-1&&(s.value.splice(i,1),s.value.push(a))},R=(v,s,a="se")=>{I.value=s.id,v.stopPropagation(),z.value.getBoundingClientRect(),s._resizeStartState={x:s.x,y:s.y,width:s.width,height:s.height,startX:v.clientX,startY:v.clientY,direction:a};const i=p=>V(p),h=()=>X();document.addEventListener("mousemove",i),document.addEventListener("mouseup",h),s._resizeMoveHandler=i,s._resizeEndHandler=h,m==null||m(s,v,a)},O=(v,s)=>{if(j&&j.isMultiDragging.value){j.handleMultiDrag(v,s);return}if(!q.value)return;const a=b.value.find(h=>h.id===q.value);if(!a)return;const i=()=>{const h=s.getBoundingClientRect();let p=v.clientX-h.left-a.startX,f=v.clientY-h.top-a.startY;if(p=Math.max(0,Math.min(p,h.width-a.width)),f=Math.max(0,Math.min(f,h.height-a.height)),T){const x=J(a,p,f,b.value,d);p=x.x,f=x.y,A.value=x.snapLines}else A.value=[];a.x=p,a.y=f,o==null||o(a,v)};N?N(i):i()},K=()=>{if(j&&j.isMultiDragging.value){j.stopMultiDrag();return}const v=b.value.find(s=>s.id===q.value);v&&(e==null||e(v),v._dragMoveHandler&&(document.removeEventListener("mousemove",v._dragMoveHandler),delete v._dragMoveHandler),v._dragEndHandler&&(document.removeEventListener("mouseup",v._dragEndHandler),delete v._dragEndHandler)),q.value=null,A.value=[]},V=v=>{if(!I.value)return;const s=b.value.find(E=>E.id===I.value);if(!s)return;const a=s._resizeStartState;if(!a)return;z.value.getBoundingClientRect();const i=v.clientX-a.startX,h=v.clientY-a.startY;let p=a.x,f=a.y,x=a.width,l=a.height;switch(a.direction){case"se":x=Math.max(50,a.width+i),l=Math.max(30,a.height+h);break;case"sw":p=a.x+i,x=Math.max(50,a.width-i),l=Math.max(30,a.height+h);break;case"ne":f=a.y+h,x=Math.max(50,a.width+i),l=Math.max(30,a.height-h);break;case"nw":p=a.x+i,f=a.y+h,x=Math.max(50,a.width-i),l=Math.max(30,a.height-h);break;case"n":f=a.y+h,l=Math.max(30,a.height-h);break;case"s":l=Math.max(30,a.height+h);break;case"e":x=Math.max(50,a.width+i);break;case"w":p=a.x+i,x=Math.max(50,a.width-i);break}p<0&&(x+=p,p=0),f<0&&(l+=f,f=0),x<50&&(x=50),l<30&&(l=30);const L=$(s,p,f,x,l,b.value,d);A.value=L,s.x=p,s.y=f,s.width=x,s.height=l,w==null||w(s,v)},X=()=>{const v=b.value.find(s=>s.id===I.value);v&&(y==null||y(v),v._resizeStartState&&delete v._resizeStartState,v._resizeMoveHandler&&(document.removeEventListener("mousemove",v._resizeMoveHandler),delete v._resizeMoveHandler),v._resizeEndHandler&&(document.removeEventListener("mouseup",v._resizeEndHandler),delete v._resizeEndHandler)),A.value=[],I.value=null},J=(v,s,a,i,h)=>{const p=[];let f=s,x=a;return i.forEach(l=>{if(l.id===v.id)return;const L=s+v.width/2,E=a+v.height/2,D=l.x+l.width/2,F=l.y+l.height/2;Math.abs(L-D)<h&&(f=D-v.width/2,p.push({id:`center-x-${l.id}`,type:"vertical",x:D,y1:Math.min(a,l.y),y2:Math.max(a+v.height,l.y+l.height)})),Math.abs(E-F)<h&&(x=F-v.height/2,p.push({id:`center-y-${l.id}`,type:"horizontal",y:F,x1:Math.min(s,l.x),x2:Math.max(s+v.width,l.x+l.width)})),Math.abs(s-l.x)<h&&(f=l.x,p.push({id:`left-${l.id}`,type:"vertical",x:l.x,y1:Math.min(a,l.y),y2:Math.max(a+v.height,l.y+l.height)})),Math.abs(s+v.width-l.x-l.width)<h&&(f=l.x+l.width-v.width,p.push({id:`right-${l.id}`,type:"vertical",x:l.x+l.width,y1:Math.min(a,l.y),y2:Math.max(a+v.height,l.y+l.height)})),Math.abs(a-l.y)<h&&(x=l.y,p.push({id:`top-${l.id}`,type:"horizontal",y:l.y,x1:Math.min(s,l.x),x2:Math.max(s+v.width,l.x+l.width)})),Math.abs(a+v.height-l.y-l.height)<h&&(x=l.y+l.height-v.height,p.push({id:`bottom-${l.id}`,type:"horizontal",y:l.y+l.height,x1:Math.min(s,l.x),x2:Math.max(s+v.width,l.x+l.width)}))}),{x:f,y:x,snapLines:p}},$=(v,s,a,i,h,p,f)=>{const x=[];return p.forEach(l=>{if(l.id===v.id)return;const L=s+i/2,E=a+h/2,D=l.x+l.width/2,F=l.y+l.height/2;Math.abs(L-D)<f&&x.push({id:`center-x-${l.id}`,type:"vertical",x:D,y1:Math.min(a,l.y),y2:Math.max(a+h,l.y+l.height),style:"center"}),Math.abs(E-F)<f&&x.push({id:`center-y-${l.id}`,type:"horizontal",y:F,x1:Math.min(s,l.x),x2:Math.max(s+i,l.x+l.width),style:"center"}),Math.abs(s-l.x)<f&&x.push({id:`left-${l.id}`,type:"vertical",x:l.x,y1:Math.min(a,l.y),y2:Math.max(a+h,l.y+l.height),style:"edge"}),Math.abs(s+i-l.x-l.width)<f&&x.push({id:`right-${l.id}`,type:"vertical",x:l.x+l.width,y1:Math.min(a,l.y),y2:Math.max(a+h,l.y+l.height),style:"edge"}),Math.abs(a-l.y)<f&&x.push({id:`top-${l.id}`,type:"horizontal",y:l.y,x1:Math.min(s,l.x),x2:Math.max(s+i,l.x+l.width),style:"edge"}),Math.abs(a+h-l.y-l.height)<f&&x.push({id:`bottom-${l.id}`,type:"horizontal",y:l.y+l.height,x1:Math.min(s,l.x),x2:Math.max(s+i,l.x+l.width),style:"edge"}),Math.abs(i-l.width)<f&&x.push({id:`width-match-${l.id}`,type:"width-match",x:s+i,y:a+h,width:l.width,style:"size-match"}),Math.abs(h-l.height)<f&&x.push({id:`height-match-${l.id}`,type:"height-match",x:s+i,y:a+h,height:l.height,style:"size-match"})}),x},ee=(v,s)=>{if(!s)return;const a=s.getBoundingClientRect();te.x=v.clientX-a.left,te.y=v.clientY-a.top,q.value&&O(v,s),I.value&&V(v),typeof window<"u"&&window.selectionBoxUpdate&&window.selectionBoxUpdate(te.x,te.y)},Z=()=>{};return Ae(()=>{b.value.forEach(v=>{v._dragMoveHandler&&(document.removeEventListener("mousemove",v._dragMoveHandler),delete v._dragMoveHandler),v._dragEndHandler&&(document.removeEventListener("mouseup",v._dragEndHandler),delete v._dragEndHandler),v._resizeMoveHandler&&(document.removeEventListener("mousemove",v._resizeMoveHandler),delete v._resizeMoveHandler),v._resizeEndHandler&&(document.removeEventListener("mouseup",v._resizeEndHandler),delete v._resizeEndHandler)})}),{draggingId:q,resizingId:I,snapLines:A,mousePos:te,startDrag:G,startResize:R,handleMouseMove:ee,handleMouseLeave:Z}}function Qt(n={}){const{elements:t=M([]),onSelectionChange:o,onMultiDragStart:e,onMultiDragMove:m,onMultiDragEnd:w}=n,y=M(new Set),d=M(!1),T=Ie({x:0,y:0}),U=M(new Map),b=Ie({x:0,y:0}),z=R=>R.metaKey||R.ctrlKey,N=(R,O)=>{z(O)?y.value.has(R)?y.value.delete(R):y.value.add(R):(y.value.clear(),y.value.add(R)),o==null||o(Array.from(y.value))},j=()=>{y.value.clear(),o==null||o([])},q=()=>t.value.filter(R=>y.value.has(R.id));return{selectedElements:y,isMultiDragging:d,selectElement:N,clearSelection:j,getSelectedElements:q,startMultiDrag:(R,O,K)=>{if(y.value.size===0)return;d.value=!0;const V=K.getBoundingClientRect();T.x=R.clientX-V.left-O.x,T.y=R.clientY-V.top-O.y,U.value.clear();const X=q();let J=0,$=0;X.forEach(ee=>{const Z=ee.x+ee.width/2,v=ee.y+ee.height/2;J+=Z,$+=v,U.value.set(ee.id,{x:ee.x,y:ee.y,centerX:Z,centerY:v})}),J/=X.length,$/=X.length,b.x=J,b.y=$,e==null||e(X,R)},handleMultiDrag:(R,O)=>{if(!d.value||y.value.size===0)return;const K=O.getBoundingClientRect(),V=q(),X=R.clientX-K.left-T.x,J=R.clientY-K.top-T.y,$=X-b.x,ee=J-b.y;V.forEach(Z=>{const v=U.value.get(Z.id);if(v){let s=v.x+$,a=v.y+ee;const i=0,h=K.width-Z.width,p=0,f=K.height-Z.height;s<i?s=i:s>h&&(s=h),a<p?a=p:a>f&&(a=f),Z.x=s,Z.y=a}}),m==null||m(V,R)},stopMultiDrag:()=>{d.value&&(d.value=!1,U.value.clear(),w==null||w(q()))},isElementSelected:R=>y.value.has(R),getSelectedCount:()=>y.value.size,isCommandPressed:z}}function Zt(n={}){const{containerRef:t,elements:o=M([]),itemHeight:e=80,itemWidth:m=120,buffer:w=5}=n,y=M([]),d=M(0),T=M(0),U=()=>{const z=t.value;if(!z||!o.value||o.value.length===0){y.value=[];return}const{width:N,height:j}=z.getBoundingClientRect(),q=Math.floor(d.value/e),I=Math.ceil((d.value+j)/e),A=Math.floor(T.value/m),te=Math.ceil((T.value+N)/m),G=Math.max(0,q-w),P=I+w,R=Math.max(0,A-w),O=te+w;y.value=o.value.filter(K=>{const V=Math.floor(K.y/e),X=Math.floor(K.x/m);return V>=G&&V<=P&&X>=R&&X<=O})};return{visibleItems:y,calculateVisibleItems:U,handleScroll:z=>{z&&z.target&&(d.value=z.target.scrollTop||0,T.value=z.target.scrollLeft||0,U())}}}class $t{constructor(t=100){this.cellSize=t,this.grid=new Map}getGridKey(t,o){const e=Math.floor(t/this.cellSize),m=Math.floor(o/this.cellSize);return`${e},${m}`}addElement(t){if(!t||typeof t.x!="number"||typeof t.y!="number")return;const o=this.getGridKey(t.x,t.y);this.grid.has(o)||this.grid.set(o,[]),this.grid.get(o).push(t)}getNearbyElements(t){if(!t||typeof t.x!="number"||typeof t.y!="number")return[];const o=new Set,e=t.x+(t.width||0)/2,m=t.y+(t.height||0)/2;for(let w=-1;w<=1;w++)for(let y=-1;y<=1;y++){const d=this.getGridKey(e+w*this.cellSize,m+y*this.cellSize);(this.grid.get(d)||[]).forEach(U=>{U.id!==t.id&&o.add(U)})}return Array.from(o)}updateGrid(t){this.grid.clear(),Array.isArray(t)&&t.forEach(o=>this.addElement(o))}}function en(n,t){let o,e=0;return function(...m){const w=Date.now();w-e>t?(n.apply(this,m),e=w):(clearTimeout(o),o=setTimeout(()=>{n.apply(this,m),e=Date.now()},t-(w-e)))}}class tn{constructor(){this.metrics={fps:0,renderTime:0,dragTime:0,memoryUsage:0},this.frameCount=0,this.lastTime=performance.now(),this.frameStart=0,this.frameTimes=[]}startFrame(){this.frameStart=performance.now()}endFrame(){if(this.frameStart>0){const o=performance.now()-this.frameStart;this.metrics.renderTime=o,this.frameTimes.push(o),this.frameTimes.length>10&&this.frameTimes.shift()}this.frameCount++;const t=performance.now();if(t-this.lastTime>=1e3){if(this.metrics.fps=Math.round(this.frameCount),this.frameCount=0,this.lastTime=t,this.frameTimes.length>0){const o=this.frameTimes.reduce((e,m)=>e+m,0)/this.frameTimes.length;this.metrics.renderTime=o}performance.memory&&(this.metrics.memoryUsage=Math.round(performance.memory.usedJSHeapSize/1024/1024))}}measureDrag(t){const o=performance.now(),e=t();return this.metrics.dragTime=performance.now()-o,e}getMetrics(){return{...this.metrics}}}function nn(n={}){const{enableVirtualization:t=!0,enableSpatialGrid:o=!0,enableThrottling:e=!0,enableMonitoring:m=!0}=n,w=m?new tn:null,y=o?new $t(100):null,d=M(null),{visibleItems:T,calculateVisibleItems:U,handleScroll:b}=Zt({containerRef:d,elements:n.elements||M([]),itemHeight:n.itemHeight||80,itemWidth:n.itemWidth||120,buffer:n.buffer||5}),z=e?en(n.handleDrag||(()=>{}),16):n.handleDrag||(()=>{});return{containerRef:d,visibleItems:T,calculateVisibleItems:U,handleScroll:b,startFrame:()=>{w&&w.startFrame()},endFrame:()=>{w&&w.endFrame()},getPerformanceMetrics:()=>w?w.getMetrics():{fps:0,renderTime:0,dragTime:0,memoryUsage:0},measureDrag:G=>w?w.measureDrag(G):G(),updateSpatialGrid:G=>{y&&y.updateGrid(G)},getNearbyElements:G=>y?y.getNearbyElements(G):[],throttledHandleDrag:z}}function $e(n){const t=M(new Set),o=M(new Map),e=M(1),m=Ie({visible:!1,startX:0,startY:0,endX:0,endY:0}),w=Ie({visible:!1,x:0,y:0,targetElements:[]});oe(()=>n.value.filter(s=>t.value.has(s.id)));const y=oe(()=>{const s=new Map;return o.value.forEach((a,i)=>{a.elementIds&&s.set(i,a.elementIds.map(h=>n.value.find(p=>p.id===h)).filter(Boolean))}),s}),d=s=>{for(const[a,i]of o.value)if(i.elementIds&&i.elementIds.includes(s))return a;return null},T=s=>{const a=d(s);if(a){const i=o.value.get(a);return{id:a,elements:i.elementIds.map(h=>n.value.find(p=>p.id===h)).filter(Boolean)}}return null},U=(s,a=!1)=>{a||t.value.clear(),t.value.add(s)},b=()=>{t.value.clear()},z=(s,a)=>{m.visible=!0,m.startX=s,m.startY=a,m.endX=s,m.endY=a},N=(s,a)=>{m.endX=s,m.endY=a},j=()=>{if(!m.visible)return;const s=Math.min(m.startX,m.endX),a=Math.max(m.startX,m.endX),i=Math.min(m.startY,m.endY),h=Math.max(m.startY,m.endY);b(),n.value.forEach(p=>{const f=p.x,x=p.x+p.width,l=p.y,L=p.y+p.height;f>=s&&x<=a&&l>=i&&L<=h&&t.value.add(p.id)}),m.visible=!1},q=()=>{try{if(t.value.size<2)return console.log("组合失败：至少需要2个组件才能组合"),null;const s=Array.from(t.value);console.log("准备组合的元素ID:",s);const a=s.map(E=>{const D=n.value.find(F=>F.id===E);return D||console.warn("未找到元素:",E),D}).filter(Boolean);if(a.length===0)return console.error("组合失败：没有有效的元素"),null;console.log("准备组合的元素:",a.map(E=>({id:E.id,x:E.x,y:E.y,width:E.width,height:E.height})));let i=1/0,h=1/0,p=-1/0,f=-1/0;if(a.forEach(E=>{typeof E.x=="number"&&typeof E.y=="number"&&typeof E.width=="number"&&typeof E.height=="number"?(i=Math.min(i,E.x),h=Math.min(h,E.y),p=Math.max(p,E.x+E.width),f=Math.max(f,E.y+E.height)):console.warn("元素数据无效:",E)}),!isFinite(i)||!isFinite(h)||!isFinite(p)||!isFinite(f))return console.error("组合失败：边界计算错误",{minX:i,minY:h,maxX:p,maxY:f}),null;const x={x:i,y:h,width:p-i,height:f-h};console.log("计算的初始边界:",x);const l=e.value++,L=a.map(E=>{const D=(E.x-x.x)/x.width,F=(E.y-x.y)/x.height,ne=E.width/x.width,ie=E.height/x.height;return{elementId:E.id,relativeX:D,relativeY:F,relativeWidth:ne,relativeHeight:ie}});return o.value.set(l,{elementIds:s,initialBounds:x,relativePositions:L}),console.log("组合创建成功:",{groupId:l,elementIds:s,initialBounds:x,relativePositions:L}),l}catch(s){return console.error("组合过程中发生错误:",s),null}},I=s=>{if(o.value.has(s)){const a=o.value.get(s);a&&a.initialBounds&&console.log("解组:",{groupId:s,initialBounds:a.initialBounds}),o.value.delete(s)}},A=()=>{const s=new Set;t.value.forEach(a=>{const i=d(a);i&&s.add(i)}),s.forEach(a=>{I(a)}),b()},te=s=>{try{const a=o.value.get(s);if(!a||!a.elementIds||a.elementIds.length===0)return console.warn("getGroupBounds: 组合数据无效",{groupId:s,groupData:a}),null;const i=a.elementIds.map(L=>{const E=n.value.find(D=>D.id===L);return E||console.warn("getGroupBounds: 未找到元素",{groupId:s,elementId:L}),E}).filter(Boolean);if(i.length===0)return console.warn("getGroupBounds: 组合中没有有效元素",{groupId:s}),null;let h=1/0,p=1/0,f=-1/0,x=-1/0;if(i.forEach(L=>{typeof L.x=="number"&&typeof L.y=="number"&&typeof L.width=="number"&&typeof L.height=="number"?(h=Math.min(h,L.x),p=Math.min(p,L.y),f=Math.max(f,L.x+L.width),x=Math.max(x,L.y+L.height)):console.warn("getGroupBounds: 元素数据无效",{element:L})}),!isFinite(h)||!isFinite(p)||!isFinite(f)||!isFinite(x))return console.error("getGroupBounds: 边界计算错误",{groupId:s,minX:h,minY:p,maxX:f,maxY:x}),null;const l={x:h,y:p,width:f-h,height:x-p,elements:i};return console.log("getGroupBounds 计算结果:",{groupId:s,bounds:l}),l}catch(a){return console.error("getGroupBounds 执行出错:",a),null}},G=(s,a,i)=>{const h=o.value.get(s);!h||!h.elementIds||(h.elementIds.forEach(p=>{const f=n.value.find(x=>x.id===p);f&&(f.x+=a,f.y+=i)}),console.log("组合移动:",{groupId:s,deltaX:a,deltaY:i}))},P=(s,a,i,h="se")=>{const p=o.value.get(s);if(!p||!p.initialBounds)return;const f=te(s);if(!f)return;const x=p.relativePositions;if(!x||x.length===0)return;let l=f.x,L=f.y,E=f.width,D=f.height;switch(h){case"se":E+=a,D+=i;break;case"sw":l+=a,E-=a,D+=i;break;case"ne":L+=i,E+=a,D-=i;break;case"nw":l+=a,L+=i,E-=a,D-=i;break;case"n":L+=i,D-=i;break;case"s":D+=i;break;case"e":E+=a;break;case"w":l+=a,E-=a;break;case"center":const ue=1+a/f.width,me=1+i/f.height,ce=Math.min(ue,me);E=f.width*ce,D=f.height*ce,l=f.x+(f.width-E)/2,L=f.y+(f.height-D)/2;break}const F=Math.max(50,f.width*.1),ne=Math.max(30,f.height*.1);E=Math.max(F,E),D=Math.max(ne,D);const ie=f.width*5,ve=f.height*5;E=Math.min(ie,E),D=Math.min(ve,D),x.forEach(({elementId:ue,relativeX:me,relativeY:ce,relativeWidth:he,relativeHeight:Be})=>{const pe=n.value.find(Me=>Me.id===ue);if(pe){const Me=l+me*E,Ge=L+ce*D,ze=he*E,De=Be*D,xe=Math.max(20,Math.min(ze,E*.8)),Ee=Math.max(15,Math.min(De,D*.8)),Le=Me+(ze-xe)/2,Te=Ge+(De-Ee)/2;pe.x=Le,pe.y=Te,pe.width=xe,pe.height=Ee}}),console.log("组合大小调整:",{groupId:s,anchor:h,deltaWidth:a,deltaHeight:i,oldSize:{width:f.width,height:f.height},newSize:{width:E,height:D},newPosition:{x:l,y:L}})},R=(s,a,i,h,p,f="se")=>{const x=o.value.get(s);if(!x||!x.initialBounds)return;const l=te(s);if(!l)return;const L=h-a,E=p-i;let D=0,F=0;switch(f){case"se":D=L,F=E;break;case"sw":D=-L,F=E;break;case"ne":D=L,F=-E;break;case"nw":D=-L,F=-E;break;case"n":D=0,F=-E;break;case"s":D=0,F=E;break;case"e":D=L,F=0;break;case"w":D=-L,F=0;break;case"center":const ne=Math.min(1+L/l.width,1+E/l.height);D=l.width*(ne-1),F=l.height*(ne-1);break}P(s,D,F,f)},O=(s,a,i,h)=>{const p=o.value.get(s);p&&(p.resizeStart={x:a,y:i,anchor:h,originalBounds:{...te(s)}},console.log("开始调整组合大小:",{groupId:s,anchor:h,startX:a,startY:i}))},K=(s,a,i)=>{const h=o.value.get(s);if(!h||!h.resizeStart)return;const{x:p,y:f,anchor:x}=h.resizeStart;R(s,p,f,a,i,x)},V=s=>{const a=o.value.get(s);a&&(delete a.resizeStart,console.log("结束调整组合大小:",{groupId:s}))},X=s=>{const a=te(s);if(!a)return[];const{x:i,y:h,width:p,height:f}=a,x=8;return[{id:"nw",x:i-x/2,y:h-x/2,cursor:"nw-resize"},{id:"ne",x:i+p-x/2,y:h-x/2,cursor:"ne-resize"},{id:"sw",x:i-x/2,y:h+f-x/2,cursor:"sw-resize"},{id:"se",x:i+p-x/2,y:h+f-x/2,cursor:"se-resize"},{id:"n",x:i+p/2-x/2,y:h-x/2,cursor:"n-resize"},{id:"s",x:i+p/2-x/2,y:h+f-x/2,cursor:"s-resize"},{id:"e",x:i+p-x/2,y:h+f/2-x/2,cursor:"e-resize"},{id:"w",x:i-x/2,y:h+f/2-x/2,cursor:"w-resize"},{id:"center",x:i+p/2-x/2,y:h+f/2-x/2,cursor:"move"}]},J=(s,a,i)=>{const h=X(s),p=8;for(const f of h)if(a>=f.x&&a<=f.x+p&&i>=f.y&&i<=f.y+p)return f.id;return null},$=(s,a,i,h="se",p={})=>{const{maintainAspectRatio:f=!1,gridSize:x=10,snapToGrid:l=!1,minScale:L=.1,maxScale:E=5}=p,D=o.value.get(s);if(!D||!D.initialBounds)return;const F=te(s);if(!F)return;let ne=F.width+a,ie=F.height+i;if(f){const he=F.width/F.height;Math.abs(a)>Math.abs(i)?ie=ne/he:ne=ie*he}l&&(ne=Math.round(ne/x)*x,ie=Math.round(ie/x)*x);const ve=ne/D.initialBounds.width,ue=ie/D.initialBounds.height;if(ve<L||ve>E||ue<L||ue>E){const he=Math.min(Math.max(Math.min(ve,ue),L),E);ne=D.initialBounds.width*he,ie=D.initialBounds.height*he}const me=ne-F.width,ce=ie-F.height;P(s,me,ce,h),console.log("约束调整组合大小:",{groupId:s,anchor:h,constraints:p,finalDelta:{width:me,height:ce}})},ee=(s,a)=>{s.preventDefault(),w.visible=!0,w.x=s.clientX,w.y=s.clientY,w.targetElements=a},Z=()=>{w.visible=!1},v=oe(()=>{if(t.value.size===0)return!1;let s=!1,a=!1;return t.value.forEach(i=>{d(i)?s=!0:a=!0}),s||a});return{selectedElementIds:t,groups:o,elementGroups:y,selectionBox:m,contextMenu:w,shouldShowGroupOptions:v,selectElement:U,clearSelection:b,startSelectionBox:z,updateSelectionBox:N,endSelectionBox:j,groupSelectedElements:q,ungroupElements:I,ungroupSelectedGroups:A,getGroupBounds:te,moveGroup:G,resizeGroup:P,smartResizeGroup:R,startResizeGroup:O,updateResizeGroup:K,endResizeGroup:V,isElementInGroup:d,getElementGroup:T,showContextMenu:ee,hideContextMenu:Z,getGroupResizeHandles:X,isPointInResizeHandle:J,constrainedResizeGroup:$}}const on={name:"OptimizedFreeLayoutWorkspace",components:{DraggableElement:qe,PerformancePanel:It,GroupBorder:Ke,SelectionBox:Je,ContextMenu:Qe},props:{elements:{type:Array,required:!0},showGrid:{type:Boolean,default:!0},enableResize:{type:Boolean,default:!0},resizeHandles:{type:Array,default:()=>["n","ne","e","se","s","sw","w","nw"]},snapDistance:{type:Number,default:10},enableSnap:{type:Boolean,default:!0},enableVirtualization:{type:Boolean,default:!0},enableSpatialGrid:{type:Boolean,default:!0},enableThrottling:{type:Boolean,default:!0},enableMonitoring:{type:Boolean,default:!1},showPerformancePanel:{type:Boolean,default:!0},itemHeight:{type:Number,default:80},itemWidth:{type:Number,default:120},buffer:{type:Number,default:5},performancePanelPosition:{type:String,default:"top-right"},performancePanelTheme:{type:String,default:"dark"},performancePanelCompact:{type:Boolean,default:!1},enableMultiSelect:{type:Boolean,default:!0}},emits:["update:elements","drag-start","drag-move","drag-end","resize-start","resize-move","resize-end","selection-change","multi-drag-start","multi-drag-move","multi-drag-end","group-elements","ungroup-elements","delete-elements"],setup(n,{emit:t}){const o=M(null),e=M(n.elements),m=M(n.performancePanelPosition||"top-right"),w=M(n.performancePanelTheme||"light"),y=M(n.performancePanelCompact||!1),d=M(n.showFps!==!1),T=M(n.showRenderTime!==!1),U=M(n.showDragTime!==!1),b=M(n.showMemoryUsage!==!1),z=M(n.showElementCount!==!1),N=M(n.showTotalElements!==!1),j=M(n.showPerformancePanelCloseButton!==!1),q=()=>{t("performance-panel-close")},I=Qt({elements:e,onSelectionChange:g=>{t("selection-change",g)},onMultiDragStart:(g,C)=>{t("multi-drag-start",g,C)},onMultiDragMove:(g,C)=>{t("multi-drag-move",g,C)},onMultiDragEnd:g=>{t("multi-drag-end",g)}}),{selectedElementIds:A,groups:te,elementGroups:G,selectElement:P,clearSelection:R,groupSelectedElements:O,ungroupSelectedGroups:K,getGroupBounds:V,isElementInGroup:X,getElementGroup:J}=$e(e),$=M({visible:!1,x:0,y:0,targetElements:[]}),ee=(g,C)=>{g.preventDefault(),$.value.visible=!0,$.value.x=g.clientX,$.value.y=g.clientY,$.value.targetElements=C},Z=()=>{$.value.visible=!1,$.value.targetElements=[]},v=()=>{const g=O();g&&console.log("组合成功，组合ID:",g),Z()},s=()=>{K(),console.log("解组成功"),Z()},a=g=>{console.log("删除选中的元素:",g),Z()},i=M({visible:!1,startX:0,startY:0,endX:0,endY:0}),h=g=>{const C=o.value.getBoundingClientRect(),se=g.clientX-C.left,fe=g.clientY-C.top;i.value.visible=!0,i.value.startX=se,i.value.startY=fe,i.value.endX=se,i.value.endY=fe,R()},p=g=>{if(i.value.visible){const C=o.value.getBoundingClientRect(),se=g.clientX-C.left,fe=g.clientY-C.top;i.value.endX=se,i.value.endY=fe}},f=()=>{if(i.value.visible){const g=Math.min(i.value.startX,i.value.endX),C=Math.max(i.value.startX,i.value.endX),se=Math.min(i.value.startY,i.value.endY),fe=Math.max(i.value.startY,i.value.endY);e.value.forEach(de=>{const lt=de.x,rt=de.x+de.width,it=de.y,dt=de.y+de.height;lt>=g&&rt<=C&&it>=se&&dt<=fe&&P(de.id,!0)}),i.value.visible=!1}},x=g=>{(g.target===o.value||g.target.classList.contains("grid"))&&h(g)},l=g=>{f()},L=(g,C)=>{if(X(C.id)){const fe=J(C.id);fe&&fe.elements.forEach(de=>{P(de.id,!0)})}else A.value.has(C.id)||P(C.id,!1);_e(g,C,o.value)},E=(g,C)=>{A.value.has(C.id)||P(C.id,!1);const se=Array.from(A.value).map(fe=>e.value.find(de=>de.id===fe)).filter(Boolean);ee(g,se)},D=g=>{const C=ne(g);C&&ie(g,C)},F=(g,C)=>{const se=ne(g);se&&ve(g,se,C)},ne=g=>{const C=g.target.closest(".group-border");return C?parseInt(C.dataset.groupId):null},ie=(g,C)=>{console.log("开始拖拽组合:",C)},ve=(g,C,se)=>{console.log("开始调整组合大小:",C,se)},ue=(g,C,se)=>{Fe(g,C,se)},me=g=>{const C={position:"absolute",pointerEvents:"none",zIndex:1e3};return g.type==="horizontal"?{...C,top:`${g.y}px`,left:`${g.x1}px`,width:`${g.x2-g.x1}px`,height:g.style==="center"?"2px":"1px",background:g.style==="center"?"#4ecdc4":"#ff6b6b",opacity:g.style==="center"?"0.9":"0.8"}:g.type==="vertical"?{...C,left:`${g.x}px`,top:`${g.y1}px`,width:g.style==="center"?"2px":"1px",height:`${g.y2-g.y1}px`,background:g.style==="center"?"#4ecdc4":"#ff6b6b",opacity:g.style==="center"?"0.9":"0.8"}:g.type==="width-match"||g.type==="height-match"?{...C,left:`${g.x}px`,top:`${g.y}px`,width:"20px",height:"20px",background:"#ffd93d",borderRadius:"50%",opacity:"0.9",transform:"translate(-50%, -50%)"}:C},ce=oe(()=>{if(n.enableVirtualization&&n.elements.length>0){const g=Math.max(...n.elements.map(de=>(de.y||0)+(de.height||0)),1e3),C=window.innerWidth||1200,se=Math.max(...n.elements.map(de=>(de.x||0)+(de.width||0)),0),fe=Math.min(Math.max(se,C),C);return{height:`${g}px`,width:`${fe}px`,position:"relative"}}return{}}),he=oe(()=>!n.enableVirtualization||!xe.value||xe.value.length===0?n.elements:xe.value),Be=g=>A.value.has(g),pe=g=>V(g),Me=oe(()=>A.value.size>=2),Ge=oe(()=>{let g=!1;return A.value.forEach(C=>{X(C)&&(g=!0)}),g});let ze;const De=()=>{Te(),n.enableVirtualization&&Ee(),H(),nt(),ze=requestAnimationFrame(De)};Oe(()=>{n.enableVirtualization&&Ee(),n.enableSpatialGrid&&c(n.elements),(n.showPerformancePanel||n.enableMonitoring)&&De()}),Ae(()=>{ze&&cancelAnimationFrame(ze)});const{visibleItems:xe,calculateVisibleItems:Ee,handleScroll:Le,startFrame:Te,endFrame:H,getPerformanceMetrics:u,updateSpatialGrid:c,measureDrag:S}=nn({enableVirtualization:n.enableVirtualization,enableSpatialGrid:n.enableSpatialGrid,enableThrottling:n.enableThrottling,enableMonitoring:n.enableMonitoring,showPerformancePanel:n.showPerformancePanel,elements:e,itemHeight:n.itemHeight,itemWidth:n.itemWidth,buffer:n.buffer});Ve(()=>n.elements,g=>{e.value=g,n.enableSpatialGrid&&c(g),n.enableVirtualization&&Ee()},{deep:!0,immediate:!0});const{draggingId:B,resizingId:Y,snapLines:ae,mousePos:be,startDrag:_e,startResize:Fe,handleMouseMove:et,handleMouseLeave:tt}=Ze({elements:e,workspaceRef:o,snapDistance:n.snapDistance,enableSnap:n.enableSnap,measureDrag:S,multiSelect:n.enableMultiSelect?I:null,onDragStart:(g,C)=>{t("drag-start",g,C)},onDragMove:(g,C)=>{t("drag-move",g,C)},onDragEnd:g=>{t("drag-end",g)},onResizeStart:(g,C,se)=>{t("resize-start",g,C,se)},onResizeMove:(g,C)=>{t("resize-move",g,C)},onResizeEnd:g=>{t("resize-end",g)}}),Ne=M({fps:0,renderTime:0,dragTime:0,memoryUsage:0}),nt=()=>{if(n.showPerformancePanel||n.enableMonitoring){const g=u();Ne.value={fps:g.fps||0,renderTime:g.renderTime||0,dragTime:g.dragTime||0,memoryUsage:g.memoryUsage||0}}},ot=g=>{n.enableVirtualization&&Le(g)},at=(g,C)=>{A.value.has(C.id)||P(C.id,!1)},st=g=>{!B.value&&!Y.value&&R()};return{containerRef:o,draggingId:B,resizingId:Y,snapLines:ae,mousePos:be,selectedElementIds:A,groups:te,elementGroups:G,selectionBox:i,contextMenu:$,canGroupSelectedElements:Me,canUngroupSelectedElements:Ge,visibleItems:xe,displayElements:he,containerStyle:ce,performanceMetrics:Ne,multiSelect:n.enableMultiSelect?I:null,getSelectedCount:n.enableMultiSelect?I.getSelectedCount:()=>0,handleElementClick:at,handleElementMouseDown:L,handleElementContextMenu:E,handleResizeStart:ue,handleWorkspaceClick:st,handleWorkspaceMouseDown:x,handleWorkspaceMouseUp:l,handleGroupMouseDown:D,handleGroupResizeStart:F,handleScroll:ot,handleMouseMove:et,handleMouseLeave:tt,handleGroupElements:v,handleUngroupElements:s,handleDeleteElements:a,showContextMenu:ee,hideContextMenu:Z,startSelectionBox:h,updateSelectionBox:p,endSelectionBox:f,getSnapLineStyle:me,isElementSelected:Be,isElementInGroup:X,getGroupBoundsForDisplay:pe,performancePanelPosition:m,performancePanelTheme:w,performancePanelCompact:y,showFps:d,showRenderTime:T,showDragTime:U,showMemoryUsage:b,showElementCount:z,showTotalElements:N,showPerformancePanelCloseButton:j,handlePerformancePanelClose:q}}},an={key:0,class:"grid"},sn={key:1,class:"snap-lines"};function ln(n,t,o,e,m,w){const y=ye("DraggableElement"),d=ye("GroupBorder"),T=ye("SelectionBox"),U=ye("ContextMenu"),b=ye("PerformancePanel");return k(),_("div",{class:"optimized-free-layout-workspace",onScroll:t[0]||(t[0]=(...z)=>e.handleScroll&&e.handleScroll(...z)),ref:"containerRef",onMousedown:t[1]||(t[1]=(...z)=>e.handleWorkspaceMouseDown&&e.handleWorkspaceMouseDown(...z)),onMousemove:t[2]||(t[2]=(...z)=>e.handleMouseMove&&e.handleMouseMove(...z)),onMouseup:t[3]||(t[3]=(...z)=>e.handleWorkspaceMouseUp&&e.handleWorkspaceMouseUp(...z)),onMouseleave:t[4]||(t[4]=(...z)=>e.handleMouseLeave&&e.handleMouseLeave(...z)),onClick:t[5]||(t[5]=(...z)=>e.handleWorkspaceClick&&e.handleWorkspaceClick(...z))},[o.showGrid?(k(),_("div",an)):W("",!0),r("div",{class:"virtualized-container",style:Pe(e.containerStyle)},[(k(!0),_(ke,null,Re(e.displayElements,z=>(k(),Se(y,{key:z.id,element:z,"is-dragging":z.id===e.draggingId,"is-resizing":z.id===e.resizingId,"is-selected":e.isElementSelected(z.id),"is-in-group":e.isElementInGroup(z.id),"enable-resize":o.enableResize,"resize-handles":o.resizeHandles,onMousedown:e.handleElementMouseDown,onClick:e.handleElementClick,onResizeStart:e.handleResizeStart,onContextmenu:e.handleElementContextMenu},{default:Ye(({element:N})=>[Ue(n.$slots,"element-content",{element:N},()=>[le(Q(N.content),1)],!0)]),_:2},1032,["element","is-dragging","is-resizing","is-selected","is-in-group","enable-resize","resize-handles","onMousedown","onClick","onResizeStart","onContextmenu"]))),128))],4),(k(!0),_(ke,null,Re(e.elementGroups,([z,N])=>(k(),Se(d,{key:`group-${z}`,visible:!0,bounds:e.getGroupBoundsForDisplay(z),"element-count":N.length,onMousedown:e.handleGroupMouseDown,onResizeStart:e.handleGroupResizeStart},null,8,["bounds","element-count","onMousedown","onResizeStart"]))),128)),Xe(T,{visible:e.selectionBox.visible,"start-x":e.selectionBox.startX,"start-y":e.selectionBox.startY,"end-x":e.selectionBox.endX,"end-y":e.selectionBox.endY},null,8,["visible","start-x","start-y","end-x","end-y"]),e.snapLines.length?(k(),_("div",sn,[(k(!0),_(ke,null,Re(e.snapLines,z=>(k(),_("div",{key:z.id,class:Ce(["snap-line",z.type]),style:Pe(e.getSnapLineStyle(z))},null,6))),128))])):W("",!0),Xe(U,{visible:e.contextMenu.visible,x:e.contextMenu.x,y:e.contextMenu.y,"target-elements":e.contextMenu.targetElements,"can-group":e.canGroupSelectedElements,"can-ungroup":e.canUngroupSelectedElements,onGroup:e.handleGroupElements,onUngroup:e.handleUngroupElements,onDelete:e.handleDeleteElements,onClose:e.hideContextMenu},null,8,["visible","x","y","target-elements","can-group","can-ungroup","onGroup","onUngroup","onDelete","onClose"]),o.showPerformancePanel?(k(),Se(b,{key:2,visible:o.showPerformancePanel,metrics:e.performanceMetrics,"element-count":e.displayElements.length,"total-elements":o.elements.length,position:e.performancePanelPosition,theme:e.performancePanelTheme,compact:e.performancePanelCompact,"show-fps":e.showFps,"show-render-time":e.showRenderTime,"show-drag-time":e.showDragTime,"show-memory-usage":e.showMemoryUsage,"show-element-count":e.showElementCount,"show-total-elements":e.showTotalElements,"show-close-button":e.showPerformancePanelCloseButton,onClose:e.handlePerformancePanelClose},{"custom-metrics":Ye(()=>[Ue(n.$slots,"custom-performance-metrics",{},void 0,!0)]),_:3},8,["visible","metrics","element-count","total-elements","position","theme","compact","show-fps","show-render-time","show-drag-time","show-memory-usage","show-element-count","show-total-elements","show-close-button","onClose"])):W("",!0)],544)}const rn=we(on,[["render",ln],["__scopeId","data-v-bafbe2d1"]]);function dn(n={}){const{initialElements:t=[],generateId:o=()=>Date.now()+Math.random()}=n,e=M(t);let m=0;const w=(G={})=>{const P=window.innerWidth||1200,R=window.innerHeight||800,O=Math.max(0,P-170),K=Math.max(0,R-130),V={id:o(),x:Math.min(Math.random()*400+50,O),y:Math.min(Math.random()*300+50,K),width:120,height:80,content:`元素 ${++m}`,startX:0,startY:0,...G};return e.value.push(V),V},y=G=>{const P=e.value.findIndex(R=>R.id===G);return P>-1?(e.value.splice(P,1),!0):!1},d=(G,P)=>{const R=e.value.find(O=>O.id===G);return R?(Object.assign(R,P),!0):!1},T=G=>e.value.find(P=>P.id===G),U=()=>{e.value=[],m=0};return{elements:e,addElement:w,removeElement:y,updateElement:d,getElement:T,clearElements:U,addElements:G=>{G.forEach(P=>{w(P)})},getElementCount:()=>e.value.length,exportLayout:()=>e.value.map(G=>({id:G.id,x:G.x,y:G.y,width:G.width,height:G.height,content:G.content})),importLayout:G=>{U(),G.forEach(P=>{w(P)})},duplicateElement:G=>{const P=T(G);if(P){const R={...P,id:o(),x:P.x+20,y:P.y+20,content:`${P.content} (副本)`};return e.value.push(R),R}return null},bringToFront:G=>{const P=T(G);if(P){const R=e.value.findIndex(O=>O.id===G);R>-1&&(e.value.splice(R,1),e.value.push(P))}},sendToBack:G=>{const P=T(G);if(P){const R=e.value.findIndex(O=>O.id===G);R>-1&&(e.value.splice(R,1),e.value.unshift(P))}},generateTestElements:(G=1e3)=>{console.log(`开始生成 ${G} 个测试元素...`),U();const P=[],R=window.innerWidth||1200,O=window.innerHeight||800,K=Math.max(0,R-170),V=Math.max(0,O-130),X=Math.floor(K/140),J=Math.floor(V/100),$=X*J,ee=G>$;console.log(`使用${ee?"随机":"网格"}布局，最大X: ${K}, 最大Y: ${V}`);const Z=100,v=Math.ceil(G/Z);for(let s=0;s<v;s++){const a=s*Z,i=Math.min(a+Z,G);for(let h=a;h<i;h++){let p,f;if(ee)p=Math.random()*K,f=Math.random()*V;else{const l=Math.floor(h/X);p=h%X*140+20,f=l*100+20}const x={id:o(),x:Math.max(0,Math.min(p,K)),y:Math.max(0,Math.min(f,V)),width:120,height:80,content:`测试元素 ${h+1}`,startX:0,startY:0};P.push(x)}}return e.value=P,m=G,console.log(`成功生成 ${P.length} 个测试元素`),P}}}const un={name:"OptimizedFreeLayoutApp",components:{OptimizedFreeLayoutWorkspace:rn},props:{title:{type:String,default:"优化版自由布局Demo"},initialElements:{type:Array,default:()=>[]},showGrid:{type:Boolean,default:!0},enableResize:{type:Boolean,default:!0},resizeHandles:{type:Array,default:()=>["se"]},snapDistance:{type:Number,default:10},enableSnap:{type:Boolean,default:!0},enableVirtualization:{type:Boolean,default:!0},enableSpatialGrid:{type:Boolean,default:!0},enableThrottling:{type:Boolean,default:!0},enableMonitoring:{type:Boolean,default:!1},showPerformancePanel:{type:Boolean,default:!1},performancePanelPosition:{type:String,default:"top-right"},performancePanelTheme:{type:String,default:"dark"},performancePanelCompact:{type:Boolean,default:!1},showFps:{type:Boolean,default:!0},showRenderTime:{type:Boolean,default:!0},showDragTime:{type:Boolean,default:!0},showMemoryUsage:{type:Boolean,default:!0},showElementCount:{type:Boolean,default:!0},showTotalElements:{type:Boolean,default:!1},showPerformancePanelCloseButton:{type:Boolean,default:!1},itemHeight:{type:Number,default:80},itemWidth:{type:Number,default:120},buffer:{type:Number,default:5},showConfigPanel:{type:Boolean,default:!1}},emits:["element-added","element-removed","element-updated","layout-exported","layout-imported","drag-start","drag-move","drag-end","resize-start","resize-move","resize-end","grid-toggled","performance-panel-close"],setup(n,{emit:t}){const o=M(null),e=M(!1),m=M(!1),w=M(0),y=M({fps:0,renderTime:0,dragTime:0,memoryUsage:0}),{elements:d,addElement:T,removeElement:U,updateElement:b,clearElements:z,generateTestElements:N}=dn({initialElements:n.initialElements}),j=M(!0),q=M(!0),I=M(!0),A=M(!0),te=M(!0),G=M(100),P=M(!1),R=M(!0),O=M("top-right"),K=M("dark"),V=M(!1),X=M(!0),J=M(!0),$=M(!0),ee=M(!0),Z=M(!0),v=M(!1),s=M(!1),a=M(80),i=M(120),h=M(5),p=M(!0),f=M(!0),x=M(["n","ne","e","se","s","sw","w","nw"]),l=M(10),L=M(!0),E=M(!0),D=M(!1),F=oe(()=>d.value.length),ne=oe(()=>0),ie=oe(()=>0),ve=()=>{p.value=!p.value,t("grid-toggled",p.value)},ue=(H,u)=>{console.log("组合成功:",H,u),t("group-elements",H,u)},me=H=>{console.log("解组成功:",H),t("ungroup-elements",H)},ce=H=>{console.log("删除元素:",H),H.forEach(u=>{U(u)}),t("delete-elements",H)},he=()=>{const H={elements:d.value,timestamp:Date.now()},u=JSON.stringify(H,null,2),c=new Blob([u],{type:"application/json"}),S=URL.createObjectURL(c),B=document.createElement("a");B.href=S,B.download=`layout-${Date.now()}.json`,B.click(),URL.revokeObjectURL(S),t("layout-exported",H)},Be=()=>{var H;(H=o.value)==null||H.click()},pe=H=>{const u=H.target.files[0];if(u){const c=new FileReader;c.onload=S=>{try{const B=JSON.parse(S.target.result);B.elements&&Array.isArray(B.elements)&&(z(),B.elements.forEach(Y=>{T(Y)}),t("layout-imported",B))}catch(B){console.error("导入布局数据失败:",B)}},c.readAsText(u)}H.target.value=""},Me=(H,u)=>{e.value=!0,t("drag-start",H,u)},Ge=(H,u)=>{t("drag-move",H,u)},ze=H=>{e.value=!1,t("drag-end",H)},De=(H,u,c)=>{m.value=!0,t("resize-start",H,u,c)},xe=(H,u)=>{t("resize-move",H,u)},Ee=H=>{m.value=!1,t("resize-end",H)},Le=()=>{R.value=!1,t("performance-panel-close")},Te=()=>{D.value=!D.value};return Ve(y,H=>{H.fps<30&&console.warn("性能警告: FPS低于30")},{deep:!0}),Ve([j,q,I,A,R,O,K,V,X,J,$,ee,Z,v,s],()=>{console.log("性能配置已更新")}),Oe(()=>{d.value.length===0&&(T(),T(),T())}),{elements:d,addElement:T,removeElement:U,updateElement:b,clearElements:z,generateTestElements:N,elementCount:F,enableVirtualization:j,enableSpatialGrid:q,enableThrottling:I,enableMonitoring:A,enableComponentPool:te,componentPoolMaxSize:G,showComponentPoolStats:P,showPerformancePanel:R,performancePanelPosition:O,performancePanelTheme:K,performancePanelCompact:V,showFps:X,showRenderTime:J,showDragTime:$,showMemoryUsage:ee,showElementCount:Z,showTotalElements:v,showPerformancePanelCloseButton:s,itemHeight:a,itemWidth:i,buffer:h,showGrid:p,enableResize:f,resizeHandles:x,snapDistance:l,enableSnap:L,enableMultiSelect:E,showConfigPanel:D,isDragging:e,isResizing:m,snapLinesCount:w,performanceMetrics:y,selectedCount:ne,groupCount:ie,toggleGrid:ve,exportLayoutData:he,importLayoutData:Be,handleFileImport:pe,handleDragStart:Me,handleDragMove:Ge,handleDragEnd:ze,handleResizeStart:De,handleResizeMove:xe,handleResizeEnd:Ee,handleGroupElements:ue,handleUngroupElements:me,handleDeleteElements:ce,handlePerformancePanelClose:Le,toggleConfigPanel:Te,fileInput:o}}},cn={class:"optimized-free-layout-app"},hn={class:"header"},mn={class:"controls"},fn={class:"workspace-container"},gn={class:"custom-element-content"},yn={class:"element-title"},vn={class:"element-info"},pn={class:"status"},xn={key:0},bn={key:1},wn={key:2},Mn={key:3},zn={key:4},En={key:0,class:"config-panel"},Sn={class:"config-items"},Cn={key:0,class:"config-items"},Dn={class:"config-items"};function kn(n,t,o,e,m,w){const y=ye("OptimizedFreeLayoutWorkspace");return k(),_("div",cn,[r("div",hn,[r("h1",null,Q(o.title),1),r("div",mn,[r("button",{onClick:t[0]||(t[0]=(...d)=>e.addElement&&e.addElement(...d))},"添加元素"),r("button",{onClick:t[1]||(t[1]=(...d)=>e.toggleGrid&&e.toggleGrid(...d))},"切换网格"),r("button",{onClick:t[2]||(t[2]=(...d)=>e.clearElements&&e.clearElements(...d))},"清空"),r("button",{onClick:t[3]||(t[3]=(...d)=>e.exportLayoutData&&e.exportLayoutData(...d))},"导出布局"),r("button",{onClick:t[4]||(t[4]=(...d)=>e.importLayoutData&&e.importLayoutData(...d))},"导入布局"),r("button",{onClick:t[5]||(t[5]=d=>e.generateTestElements(100)),class:"test-btn"}," 生成测试元素 "),r("button",{onClick:t[6]||(t[6]=(...d)=>e.toggleConfigPanel&&e.toggleConfigPanel(...d)),class:"config-btn"}," 性能配置 ")])]),r("div",fn,[Xe(y,{elements:e.elements,"show-grid":e.showGrid,"enable-resize":e.enableResize,"resize-handles":e.resizeHandles,"snap-distance":e.snapDistance,"enable-snap":e.enableSnap,"enable-virtualization":e.enableVirtualization,"enable-spatial-grid":e.enableSpatialGrid,"enable-throttling":e.enableThrottling,"enable-monitoring":e.enableMonitoring,"show-performance-panel":e.showPerformancePanel,"performance-panel-position":e.performancePanelPosition,"performance-panel-theme":e.performancePanelTheme,"performance-panel-compact":e.performancePanelCompact,"show-fps":e.showFps,"show-render-time":e.showRenderTime,"show-drag-time":e.showDragTime,"show-memory-usage":e.showMemoryUsage,"show-element-count":e.showElementCount,"show-total-elements":e.showTotalElements,"show-performance-panel-close-button":e.showPerformancePanelCloseButton,"item-height":e.itemHeight,"item-width":e.itemWidth,buffer:e.buffer,onDragStart:e.handleDragStart,onDragMove:e.handleDragMove,onDragEnd:e.handleDragEnd,onResizeStart:e.handleResizeStart,onResizeMove:e.handleResizeMove,onResizeEnd:e.handleResizeEnd,onGroupElements:e.handleGroupElements,onUngroupElements:e.handleUngroupElements,onDeleteElements:e.handleDeleteElements,onPerformancePanelClose:e.handlePerformancePanelClose},{"element-content":Ye(({element:d})=>[Ue(n.$slots,"element-content",{element:d},()=>[r("div",gn,[r("div",yn,Q(d.content),1),r("div",vn,Q(d.width)+" × "+Q(d.height),1)])],!0)]),"custom-performance-metrics":Ye(()=>[Ue(n.$slots,"custom-performance-metrics",{},void 0,!0)]),_:3},8,["elements","show-grid","enable-resize","resize-handles","snap-distance","enable-snap","enable-virtualization","enable-spatial-grid","enable-throttling","enable-monitoring","show-performance-panel","performance-panel-position","performance-panel-theme","performance-panel-compact","show-fps","show-render-time","show-drag-time","show-memory-usage","show-element-count","show-total-elements","show-performance-panel-close-button","item-height","item-width","buffer","onDragStart","onDragMove","onDragEnd","onResizeStart","onResizeMove","onResizeEnd","onGroupElements","onUngroupElements","onDeleteElements","onPerformancePanelClose"])]),r("div",pn,[r("span",null,"元素数量: "+Q(e.elementCount),1),e.isDragging?(k(),_("span",xn,"拖拽中...")):W("",!0),e.isResizing?(k(),_("span",bn,"调整大小中...")):W("",!0),e.snapLinesCount>0?(k(),_("span",wn,"吸附线: "+Q(e.snapLinesCount),1)):W("",!0),e.selectedCount>0?(k(),_("span",Mn,"选中: "+Q(e.selectedCount),1)):W("",!0),e.groupCount>0?(k(),_("span",zn,"组合: "+Q(e.groupCount),1)):W("",!0)]),e.showConfigPanel?(k(),_("div",En,[t[47]||(t[47]=r("h3",null,"性能配置",-1)),r("div",Sn,[r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[7]||(t[7]=d=>e.enableVirtualization=d)},null,512),[[ge,e.enableVirtualization]]),t[26]||(t[26]=le(" 虚拟化渲染 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[8]||(t[8]=d=>e.enableSpatialGrid=d)},null,512),[[ge,e.enableSpatialGrid]]),t[27]||(t[27]=le(" 空间分区 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[9]||(t[9]=d=>e.enableThrottling=d)},null,512),[[ge,e.enableThrottling]]),t[28]||(t[28]=le(" 节流优化 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[10]||(t[10]=d=>e.enableMonitoring=d)},null,512),[[ge,e.enableMonitoring]]),t[29]||(t[29]=le(" 性能监控 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[11]||(t[11]=d=>e.showPerformancePanel=d)},null,512),[[ge,e.showPerformancePanel]]),t[30]||(t[30]=le(" 显示性能面板 ",-1))])]),e.showPerformancePanel?(k(),_("div",Cn,[t[43]||(t[43]=r("h4",null,"性能面板配置",-1)),r("label",null,[t[32]||(t[32]=le(" 位置: ",-1)),re(r("select",{"onUpdate:modelValue":t[12]||(t[12]=d=>e.performancePanelPosition=d)},t[31]||(t[31]=[r("option",{value:"top-right"},"右上角",-1),r("option",{value:"top-left"},"左上角",-1),r("option",{value:"bottom-right"},"右下角",-1),r("option",{value:"bottom-left"},"左下角",-1)]),512),[[je,e.performancePanelPosition]])]),r("label",null,[t[34]||(t[34]=le(" 主题: ",-1)),re(r("select",{"onUpdate:modelValue":t[13]||(t[13]=d=>e.performancePanelTheme=d)},t[33]||(t[33]=[r("option",{value:"dark"},"深色",-1),r("option",{value:"light"},"浅色",-1)]),512),[[je,e.performancePanelTheme]])]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[14]||(t[14]=d=>e.performancePanelCompact=d)},null,512),[[ge,e.performancePanelCompact]]),t[35]||(t[35]=le(" 紧凑模式 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[15]||(t[15]=d=>e.showFps=d)},null,512),[[ge,e.showFps]]),t[36]||(t[36]=le(" 显示FPS ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[16]||(t[16]=d=>e.showRenderTime=d)},null,512),[[ge,e.showRenderTime]]),t[37]||(t[37]=le(" 显示渲染时间 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[17]||(t[17]=d=>e.showDragTime=d)},null,512),[[ge,e.showDragTime]]),t[38]||(t[38]=le(" 显示拖拽时间 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[18]||(t[18]=d=>e.showMemoryUsage=d)},null,512),[[ge,e.showMemoryUsage]]),t[39]||(t[39]=le(" 显示内存使用 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[19]||(t[19]=d=>e.showElementCount=d)},null,512),[[ge,e.showElementCount]]),t[40]||(t[40]=le(" 显示可见元素数 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[20]||(t[20]=d=>e.showTotalElements=d)},null,512),[[ge,e.showTotalElements]]),t[41]||(t[41]=le(" 显示总元素数 ",-1))]),r("label",null,[re(r("input",{type:"checkbox","onUpdate:modelValue":t[21]||(t[21]=d=>e.showPerformancePanelCloseButton=d)},null,512),[[ge,e.showPerformancePanelCloseButton]]),t[42]||(t[42]=le(" 显示关闭按钮 ",-1))])])):W("",!0),r("div",Dn,[r("label",null,[t[44]||(t[44]=le(" 虚拟化项目高度: ",-1)),re(r("input",{type:"number","onUpdate:modelValue":t[22]||(t[22]=d=>e.itemHeight=d),min:"20",max:"200",step:"10"},null,512),[[He,e.itemHeight]])]),r("label",null,[t[45]||(t[45]=le(" 虚拟化项目宽度: ",-1)),re(r("input",{type:"number","onUpdate:modelValue":t[23]||(t[23]=d=>e.itemWidth=d),min:"50",max:"300",step:"10"},null,512),[[He,e.itemWidth]])]),r("label",null,[t[46]||(t[46]=le(" 缓冲区大小: ",-1)),re(r("input",{type:"number","onUpdate:modelValue":t[24]||(t[24]=d=>e.buffer=d),min:"1",max:"20",step:"1"},null,512),[[He,e.buffer]])])])])):W("",!0),r("input",{ref:"fileInput",type:"file",accept:".json",style:{display:"none"},onChange:t[25]||(t[25]=(...d)=>e.handleFileImport&&e.handleFileImport(...d))},null,544)])}const Rn=we(un,[["render",kn],["__scopeId","data-v-fc5fda0b"]]),Bn={name:"FreeLayoutWorkspace",components:{DraggableElement:qe,GroupBorder:Ke,ContextMenu:Qe,SelectionBox:Je},props:{elements:{type:Array,required:!0},showGrid:{type:Boolean,default:!0},enableResize:{type:Boolean,default:!0},resizeHandles:{type:Array,default:()=>["se"]},snapDistance:{type:Number,default:10},enableSnap:{type:Boolean,default:!0},onDragStart:Function,onDragMove:Function,onDragEnd:Function,onResizeStart:Function,onResizeMove:Function,onResizeEnd:Function},emits:["update:elements","drag-start","drag-move","drag-end","resize-start","resize-move","resize-end"],setup(n,{emit:t}){const o=M(null),e=oe(()=>n.elements),{selectedElementIds:m,groups:w,elementGroups:y,selectionBox:d,contextMenu:T,selectElement:U,clearSelection:b,startSelectionBox:z,updateSelectionBox:N,endSelectionBox:j,groupSelectedElements:q,ungroupSelectedGroups:I,getGroupBounds:A,moveGroup:te,resizeGroup:G,isElementInGroup:P,getElementGroup:R,showContextMenu:O,hideContextMenu:K}=$e(e),V=Ie({visible:!1,x:0,y:0,targetElements:[]}),X=M(null),J=M(null),{draggingId:$,resizingId:ee,snapLines:Z,mousePos:v,startDrag:s,startResize:a,handleMouseMove:i,handleMouseLeave:h}=Ze({elements:e,workspaceRef:oe(()=>o.value),snapDistance:n.snapDistance,enableSnap:n.enableSnap,enableResize:n.enableResize,onDragStart:(u,c)=>{var S;t("drag-start",u,c),(S=n.onDragStart)==null||S.call(n,u,c)},onDragMove:(u,c)=>{var S;t("drag-move",u,c),(S=n.onDragMove)==null||S.call(n,u,c)},onDragEnd:u=>{var c;t("drag-end",u),(c=n.onDragEnd)==null||c.call(n,u)},onResizeStart:(u,c,S)=>{var B;t("resize-start",u,c,S),(B=n.onResizeStart)==null||B.call(n,u,c,S)},onResizeMove:(u,c)=>{var S;t("resize-move",u,c),(S=n.onResizeMove)==null||S.call(n,u,c)},onResizeEnd:u=>{var c;t("resize-end",u),(c=n.onResizeEnd)==null||c.call(n,u)}}),p=u=>{if(u.target===o.value||u.target.classList.contains("grid")){const c=o.value.getBoundingClientRect(),S=u.clientX-c.left,B=u.clientY-c.top;z(S,B),b(),window.selectionBoxUpdate=(Y,ae)=>{N(Y,ae)}}},f=u=>{d.visible&&(j(),window.selectionBoxUpdate&&delete window.selectionBoxUpdate)},x=u=>{(u.target===o.value||u.target.classList.contains("grid"))&&!$.value&&!ee.value&&m.value.size===0&&b()},l=(u,c)=>{console.log("元素点击事件:",c.id,c.content),m.value.has(c.id)||(U(c.id,!1),console.log("选中元素:",c.id))},L=(u,c)=>{console.log("元素鼠标按下事件:",c.id,c.content);const S=P(c.id);if(S){console.log("元素在组合中:",S);const B=R(c.id);B&&B.elements.forEach(Y=>{U(Y.id,!0)})}else m.value.has(c.id)||(U(c.id,!1),console.log("选中元素:",c.id));console.log("开始拖拽元素:",c.id),s(u,c,o.value)},E=(u,c)=>{m.value.has(c.id)||U(c.id,!1);const S=Array.from(m.value).map(B=>e.value.find(Y=>Y.id===B)).filter(Boolean);O(u,S)},D=u=>{const c=ne(u);c&&ie(u,c)},F=(u,c)=>{const S=ne(u);S&&ve(u,S,c)},ne=u=>{const c=u.target.closest(".group-border");if(c){const S=c.dataset.groupId;if(S)return parseInt(S);const B=c.getAttribute("data-group-id");if(B)return parseInt(B)}return null},ie=(u,c)=>{const S=w.value.get(c);if(!S||!S.elementIds)return;S.elementIds.forEach(Y=>{U(Y,!0)});const B=A(c);if(B){const Y=B.x+B.width/2,ae=B.y+B.height/2,be=o.value.getBoundingClientRect(),_e=u.clientX-be.left,Fe=u.clientY-be.top;X.value={groupId:c,startCenterX:Y,startCenterY:ae,mouseOffsetX:_e-Y,mouseOffsetY:Fe-ae,startBounds:{...B}},console.log("开始组合拖拽:",{groupId:c,groupBounds:B,groupCenter:{x:Y,y:ae},mouseOffset:{x:_e-Y,y:Fe-ae}}),document.addEventListener("mousemove",ue),document.addEventListener("mouseup",me)}},ve=(u,c,S)=>{const B=w.value.get(c);if(!B||!B.elementIds)return;B.elementIds.forEach(ae=>{U(ae,!0)});const Y=A(c);Y&&(J.value={groupId:c,handle:S,startBounds:{...Y},startMouseX:u.clientX,startMouseY:u.clientY},console.log("开始组合调整大小:",{groupId:c,handle:S,startBounds:Y}),document.addEventListener("mousemove",ce),document.addEventListener("mouseup",he))},ue=u=>{if(!X.value)return;const c=o.value.getBoundingClientRect(),S=u.clientX-c.left,B=u.clientY-c.top,Y=S-X.value.mouseOffsetX,ae=B-X.value.mouseOffsetY,be=Y-X.value.startCenterX,_e=ae-X.value.startCenterY;te(X.value.groupId,be,_e),X.value.startCenterX=Y,X.value.startCenterY=ae},me=()=>{X.value&&(console.log("组合拖拽结束:",X.value),X.value=null,document.removeEventListener("mousemove",ue),document.removeEventListener("mouseup",me))},ce=u=>{if(!J.value)return;const c=u.clientX-J.value.startMouseX,S=u.clientY-J.value.startMouseY;let B=0,Y=0;const ae=J.value.handle;switch(ae){case"se":B=c,Y=S;break;case"sw":B=-c,Y=S;break;case"ne":B=c,Y=-S;break;case"nw":B=-c,Y=-S;break;case"n":Y=-S;break;case"s":Y=S;break;case"e":B=c;break;case"w":B=-c;break}G(J.value.groupId,B,Y,ae)},he=()=>{J.value&&(console.log("组合调整大小结束:",J.value),J.value=null,document.removeEventListener("mousemove",ce),document.removeEventListener("mouseup",he))},Be=u=>m.value.has(u),pe=u=>A(u),Me=oe(()=>m.value.size>=2),Ge=oe(()=>{let u=!1;return m.value.forEach(c=>{P(c)&&(u=!0)}),u});return{workspaceRef:o,draggingId:$,resizingId:ee,snapLines:Z,mousePos:v,selectedElementIds:m,groups:w,elementGroups:y,selectionBox:d,contextMenu:T,workspaceContextMenu:V,groupDragState:X,groupResizeState:J,handleWorkspaceMouseDown:p,handleWorkspaceMouseUp:f,handleElementMouseDown:L,handleResizeStart:(u,c,S)=>{var B;try{if(u.stopPropagation(),!c||!S){console.warn("handleResizeStart: 缺少必要参数",{element:c,handle:S});return}if(!c.id||typeof c.x!="number"||typeof c.y!="number"){console.warn("handleResizeStart: 元素数据无效",c);return}m.value.has(c.id)||U(c.id,!1);const Y=P(c.id);if(Y){const ae=R(c.id);ae&&(ae.elements.forEach(be=>{U(be.id,!0)}),c._isGroupResize=!0,c._groupResizeData={groupId:Y,originalBounds:A(Y),elementIds:ae.elements.map(be=>be.id)},console.log("开始组合调整大小:",{groupId:Y,elementId:c.id,handle:S,originalBounds:c._groupResizeData.originalBounds}))}c._resizeStartTime=performance.now(),a(u,c,S),t("resize-start",c,u,S),(B=n.onResizeStart)==null||B.call(n,c,u,S),console.log("开始调整元素大小:",{elementId:c.id,handle:S,position:{x:c.x,y:c.y},size:{width:c.width,height:c.height}})}catch(Y){console.error("handleResizeStart 执行出错:",Y)}},handleMouseMove:u=>i(u,o.value),handleMouseLeave:h,handleWorkspaceClick:x,handleElementClick:l,handleElementContextMenu:E,handleGroupMouseDown:D,handleGroupResizeStart:F,handleGroupDragMove:ue,handleGroupDragEnd:me,handleGroupResizeMove:ce,handleGroupResizeEnd:he,getSnapLineStyle:u=>{const c={position:"absolute",pointerEvents:"none",zIndex:1e3};return u.type==="horizontal"?{...c,top:`${u.y}px`,left:`${u.x1}px`,width:`${u.x2-u.x1}px`,height:u.style==="center"?"2px":"1px",background:u.style==="center"?"#4ecdc4":"#ff6b6b",opacity:u.style==="center"?"0.9":"0.8"}:u.type==="vertical"?{...c,left:`${u.x}px`,top:`${u.y1}px`,width:u.style==="center"?"2px":"1px",height:`${u.y2-u.y1}px`,background:u.style==="center"?"#4ecdc4":"#ff6b6b",opacity:u.style==="center"?"0.9":"0.8"}:u.type==="width-match"||u.type==="height-match"?{...c,left:`${u.x}px`,top:`${u.y}px`,width:"20px",height:"20px",background:"#ffd93d",borderRadius:"50%",opacity:"0.9",transform:"translate(-50%, -50%)"}:c},isElementSelected:Be,isElementInGroup:P,getGroupBoundsForDisplay:pe,canGroupSelectedElements:Me,canUngroupSelectedElements:Ge,handleGroupElements:()=>{const u=q();u&&console.log("组合成功，组合ID:",u)},handleUngroupElements:()=>{I(),console.log("解组成功")},handleDeleteElements:()=>{const u=Array.from(m.value);e.value=e.value.filter(c=>!u.includes(c.id)),b(),t("update:elements",e.value),console.log("删除选中的元素:",u)},hideContextMenu:K,showWorkspaceContextMenu:u=>{u.preventDefault();const c=Array.from(m.value).map(S=>e.value.find(B=>B.id===S)).filter(Boolean);V.targetElements=c,V.x=u.clientX,V.y=u.clientY,V.visible=!0},hideWorkspaceContextMenu:()=>{V.visible=!1}}}},Gn={key:0,class:"grid"},Pn={class:"snap-lines"};function Ln(n,t,o,e,m,w){const y=ye("DraggableElement"),d=ye("GroupBorder"),T=ye("SelectionBox"),U=ye("ContextMenu");return k(),_("div",{ref:"workspaceRef",class:"free-layout-workspace",onMousedown:t[0]||(t[0]=(...b)=>e.handleWorkspaceMouseDown&&e.handleWorkspaceMouseDown(...b)),onMousemove:t[1]||(t[1]=(...b)=>e.handleMouseMove&&e.handleMouseMove(...b)),onMouseup:t[2]||(t[2]=(...b)=>e.handleWorkspaceMouseUp&&e.handleWorkspaceMouseUp(...b)),onMouseleave:t[3]||(t[3]=(...b)=>e.handleMouseLeave&&e.handleMouseLeave(...b)),onClick:t[4]||(t[4]=(...b)=>e.handleWorkspaceClick&&e.handleWorkspaceClick(...b)),onContextmenu:t[5]||(t[5]=(...b)=>e.showWorkspaceContextMenu&&e.showWorkspaceContextMenu(...b)),tabindex:"0"},[o.showGrid?(k(),_("div",Gn)):W("",!0),(k(!0),_(ke,null,Re(o.elements,b=>(k(),Se(y,{key:b.id,element:b,"is-dragging":e.draggingId===b.id,"is-resizing":e.resizingId===b.id,"is-selected":e.isElementSelected(b.id),"is-in-group":e.isElementInGroup(b.id),"enable-resize":o.enableResize,"resize-handles":o.resizeHandles,onMousedown:e.handleElementMouseDown,onClick:e.handleElementClick,onResizeStart:e.handleResizeStart,onContextmenu:e.handleElementContextMenu},null,8,["element","is-dragging","is-resizing","is-selected","is-in-group","enable-resize","resize-handles","onMousedown","onClick","onResizeStart","onContextmenu"]))),128)),(k(!0),_(ke,null,Re(e.elementGroups,([b,z])=>(k(),Se(d,{key:`group-${b}`,visible:!0,bounds:e.getGroupBoundsForDisplay(b),"element-count":z.length,"group-id":b,onMousedown:e.handleGroupMouseDown,onResizeStart:e.handleGroupResizeStart},null,8,["bounds","element-count","group-id","onMousedown","onResizeStart"]))),128)),Xe(T,{visible:e.selectionBox.visible,"start-x":e.selectionBox.startX,"start-y":e.selectionBox.startY,"end-x":e.selectionBox.endX,"end-y":e.selectionBox.endY},null,8,["visible","start-x","start-y","end-x","end-y"]),r("div",Pn,[(k(!0),_(ke,null,Re(e.snapLines,b=>(k(),_("div",{key:b.id,class:Ce(["snap-line",b.type]),style:Pe(e.getSnapLineStyle(b))},null,6))),128))]),Xe(U,{visible:e.contextMenu.visible,x:e.contextMenu.x,y:e.contextMenu.y,"target-elements":e.contextMenu.targetElements,"can-group":e.canGroupSelectedElements,"can-ungroup":e.canUngroupSelectedElements,onGroup:e.handleGroupElements,onUngroup:e.handleUngroupElements,onDelete:e.handleDeleteElements,onClose:e.hideContextMenu},null,8,["visible","x","y","target-elements","can-group","can-ungroup","onGroup","onUngroup","onDelete","onClose"]),e.workspaceContextMenu.visible?(k(),Se(U,{key:1,visible:e.workspaceContextMenu.visible,x:e.workspaceContextMenu.x,y:e.workspaceContextMenu.y,"target-elements":e.workspaceContextMenu.targetElements,"can-group":e.canGroupSelectedElements,"can-ungroup":!1,onGroup:e.handleGroupElements,onDelete:e.handleDeleteElements,onClose:e.hideWorkspaceContextMenu},null,8,["visible","x","y","target-elements","can-group","onGroup","onDelete","onClose"])):W("",!0)],544)}const Tn=we(Bn,[["render",Ln],["__scopeId","data-v-6149066f"]]),_n={name:"SelectionAndGroupDemo",components:{FreeLayoutWorkspace:Tn},setup(){const n=M([]);let t=1;const o=M("等待操作"),e=()=>[{id:t++,x:50,y:50,width:120,height:80,content:"小元素1"},{id:t++,x:200,y:50,width:150,height:100,content:"中等元素2"},{id:t++,x:400,y:50,width:180,height:120,content:"大元素3"},{id:t++,x:50,y:200,width:100,height:60,content:"小元素4"},{id:t++,x:200,y:200,width:130,height:90,content:"中等元素5"},{id:t++,x:400,y:200,width:160,height:110,content:"大元素6"}],m=()=>{const I={id:t++,x:Math.random()*400+100,y:Math.random()*300+100,width:120+Math.random()*80,height:80+Math.random()*60,content:`新元素 ${t-1}`};n.value.push(I),o.value=`添加了元素 ${I.content}`},w=()=>{n.value=[],t=1,o.value="清空了所有元素"},y=()=>{n.value=e(),t=n.value.length+1,o.value="重置了布局"},d=I=>{o.value=`开始拖拽元素: ${I.content}`},T=I=>{o.value=`拖拽元素: ${I.content}`},U=I=>{o.value=`完成拖拽元素: ${I.content}`},b=I=>{o.value=`开始调整元素大小: ${I.content}`},z=I=>{o.value=`调整元素大小: ${I.content}`},N=I=>{o.value=`完成调整元素大小: ${I.content}`},j=oe(()=>0),q=oe(()=>0);return Oe(()=>{n.value=e(),t=n.value.length+1,o.value="页面已加载，可以开始操作"}),{elements:n,currentOperation:o,groupCount:j,selectedCount:q,addElement:m,clearElements:w,resetLayout:y,handleDragStart:d,handleDragMove:T,handleDragEnd:U,handleResizeStart:b,handleResizeMove:z,handleResizeEnd:N}}},Un={class:"selection-group-demo"},In={class:"toolbar"},Xn={class:"toolbar-controls"},Yn={class:"workspace-container"},Fn={class:"status-panel"},Hn={class:"status-item"},Vn={class:"value"},Wn={class:"status-item"},An={class:"value"},On={class:"status-item"},Nn={class:"value"},jn={class:"status-item"},qn={class:"value"};function Kn(n,t,o,e,m,w){const y=ye("FreeLayoutWorkspace");return k(),_("div",Un,[r("div",In,[t[3]||(t[3]=r("h2",null,"框选和分组功能演示",-1)),r("div",Xn,[r("button",{onClick:t[0]||(t[0]=(...d)=>e.addElement&&e.addElement(...d)),class:"btn"},"添加元素"),r("button",{onClick:t[1]||(t[1]=(...d)=>e.clearElements&&e.clearElements(...d)),class:"btn"},"清空元素"),r("button",{onClick:t[2]||(t[2]=(...d)=>e.resetLayout&&e.resetLayout(...d)),class:"btn"},"重置布局")]),t[4]||(t[4]=ct('<div class="instructions" data-v-fa6c1f0d><p data-v-fa6c1f0d><strong data-v-fa6c1f0d>使用说明：</strong></p><ul data-v-fa6c1f0d><li data-v-fa6c1f0d><strong data-v-fa6c1f0d>框选功能：</strong>在空白区域按住鼠标左键拖拽，会显示选择框</li><li data-v-fa6c1f0d><strong data-v-fa6c1f0d>完全覆盖选择：</strong>只有完全被选择框覆盖的元素才会被选中</li><li data-v-fa6c1f0d><strong data-v-fa6c1f0d>右键菜单：</strong>框选完成后，在画布上右键点击显示操作菜单</li><li data-v-fa6c1f0d><strong data-v-fa6c1f0d>成组操作：</strong>选择&quot;成组&quot;将多个元素组合为一个整体</li><li data-v-fa6c1f0d><strong data-v-fa6c1f0d>分组操作：</strong>分组后的元素可以整体拖拽和调整大小</li><li data-v-fa6c1f0d><strong data-v-fa6c1f0d>解组操作：</strong>选择&quot;解组&quot;可以解除组合</li></ul></div>',1))]),r("div",Yn,[Xe(y,{elements:e.elements,"show-grid":!0,"enable-resize":!0,"resize-handles":["n","ne","e","se","s","sw","w","nw"],"snap-distance":10,"enable-snap":!0,onDragStart:e.handleDragStart,onDragMove:e.handleDragMove,onDragEnd:e.handleDragEnd,onResizeStart:e.handleResizeStart,onResizeMove:e.handleResizeMove,onResizeEnd:e.handleResizeEnd},null,8,["elements","onDragStart","onDragMove","onDragEnd","onResizeStart","onResizeMove","onResizeEnd"])]),r("div",Fn,[r("div",Hn,[t[5]||(t[5]=r("span",{class:"label"},"元素数量:",-1)),r("span",Vn,Q(e.elements.length),1)]),r("div",Wn,[t[6]||(t[6]=r("span",{class:"label"},"组合数量:",-1)),r("span",An,Q(e.groupCount),1)]),r("div",On,[t[7]||(t[7]=r("span",{class:"label"},"选中元素:",-1)),r("span",Nn,Q(e.selectedCount),1)]),r("div",jn,[t[8]||(t[8]=r("span",{class:"label"},"当前操作:",-1)),r("span",qn,Q(e.currentOperation),1)])])])}const Jn=we(_n,[["render",Kn],["__scopeId","data-v-fa6c1f0d"]]),Qn={name:"App",components:{OptimizedFreeLayoutApp:Rn,SelectionAndGroupDemo:Jn},setup(){const n=M(!0);return{currentDemo:M("optimized"),showGrid:n,toggleGrid:()=>{n.value=!n.value,console.log("网格状态:",n.value?"显示":"隐藏")},handleDragStart:(z,N)=>{console.log("开始拖拽:",z.content)},handleDragMove:(z,N)=>{},handleDragEnd:z=>{console.log("结束拖拽:",z.content)},handleResizeStart:(z,N,j)=>{console.log("开始调整大小:",z.content,j)},handleResizeMove:(z,N)=>{},handleResizeEnd:z=>{console.log("结束调整大小:",z.content)},handleLayoutExported:z=>{console.log("布局已导出:",z)},handleLayoutImported:z=>{console.log("布局已导入:",z)}}}},Zn={class:"app-container"},$n={class:"app-header"},eo={class:"app-nav"},to={class:"app-content"},no={class:"custom-element-content"},oo={class:"element-title"},ao={class:"element-info"};function so(n,t,o,e,m,w){const y=ye("OptimizedFreeLayoutApp"),d=ye("SelectionAndGroupDemo");return k(),_("div",Zn,[r("div",$n,[t[2]||(t[2]=r("h1",null,"自由布局演示",-1)),r("div",eo,[r("button",{onClick:t[0]||(t[0]=T=>e.currentDemo="optimized"),class:Ce([{active:e.currentDemo==="optimized"},"nav-btn"])}," 优化版布局 ",2),r("button",{onClick:t[1]||(t[1]=T=>e.currentDemo="selection-group"),class:Ce([{active:e.currentDemo==="selection-group"},"nav-btn"])}," 框选和分组 ",2)])]),r("div",to,[e.currentDemo==="optimized"?(k(),Se(y,{key:0,title:"优化版自由布局Demo","show-grid":e.showGrid,"enable-resize":!0,"resize-handles":["se"],"snap-distance":10,"enable-snap":!0,"enable-virtualization":!0,"enable-spatial-grid":!0,"enable-throttling":!0,"enable-monitoring":!0,"show-performance-panel":!0,"performance-panel-position":"top-right","performance-panel-theme":"dark","performance-panel-compact":!1,"show-config-panel":!1,"item-height":80,"item-width":120,buffer:5,onGridToggled:e.toggleGrid,onDragStart:e.handleDragStart,onDragMove:e.handleDragMove,onDragEnd:e.handleDragEnd,onResizeStart:e.handleResizeStart,onResizeMove:e.handleResizeMove,onResizeEnd:e.handleResizeEnd,onLayoutExported:e.handleLayoutExported,onLayoutImported:e.handleLayoutImported},{"element-content":Ye(({element:T})=>[r("div",no,[r("div",oo,Q(T.content),1),r("div",ao,Q(T.width)+" × "+Q(T.height),1)])]),_:1},8,["show-grid","onGridToggled","onDragStart","onDragMove","onDragEnd","onResizeStart","onResizeMove","onResizeEnd","onLayoutExported","onLayoutImported"])):W("",!0),e.currentDemo==="selection-group"?(k(),Se(d,{key:1})):W("",!0)])])}const lo=we(Qn,[["render",so],["__scopeId","data-v-c939c808"]]);ht(lo).mount("#app");
